<!doctype html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='52'>üåê</text></svg>"
    />
    <title>FlagFill Quiz ‚Äî Guess the Country</title>
    <meta
      name="description"
      content="FlagFill Quiz: guess the country from its flag emoji. Pick from four masked country names and keep your streak alive."
    />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#0b1220" />

    <!-- Social previews -->
    <meta property="og:title" content="FlagFill Quiz ‚Äî Guess the Country" />
    <meta
      property="og:description"
      content="Guess the country from its flag emoji. Fill the missing letters. Keep your streak alive."
    />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="FlagFill Quiz ‚Äî Guess the Country" />
    <meta
      name="twitter:description"
      content="Guess the country from its flag emoji. Fill the missing letters. Keep your streak alive."
    />

    <script>
      // Tailwind CDN config (must be tailwind.config for CDN)
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            keyframes: {
              pop: {
                "0%": { transform: "scale(0.98)", opacity: "0.6" },
                "100%": { transform: "scale(1)", opacity: "1" },
              },
            },
            animation: {
              pop: "pop 220ms ease-out",
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .ff-letter {
        font-variant-numeric: tabular-nums;
        letter-spacing: 0.02em;
      }
    </style>
  </head>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFQKVLFYBZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZFQKVLFYBZ');
</script>

  <body
    class="min-h-dvh bg-slate-50 text-slate-900 antialiased selection:bg-slate-900 selection:text-white dark:bg-slate-950 dark:text-slate-100"
  >
    <div class="mx-auto flex min-h-dvh max-w-3xl flex-col px-4 py-6 sm:px-6">
      <!-- Header -->
      <header class="flex items-center justify-between gap-3">
        <div class="min-w-0">
          <h1 class="truncate text-lg font-semibold tracking-tight sm:text-xl">
            FlagFill Quiz
          </h1>
          <p class="text-sm text-slate-600 dark:text-slate-400">
            Guess the country from the flag ‚Äî fill the missing letters.
          </p>
        </div>

        <button
          id="themeBtn"
          type="button"
          class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-800 shadow-sm transition hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus:ring-slate-700"
          aria-label="Toggle theme"
          aria-pressed="false"
        >
          <span id="themeIcon" class="leading-none">‚òæ</span>
          <span class="ml-2 hidden sm:inline"></span>
        </button>
      </header>

      <!-- Main card -->
      <main class="flex flex-1 flex-col justify-center">
        <section
          class="mt-6 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900 sm:p-6"
        >
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-sm font-medium text-slate-600 dark:text-slate-400">
                Current streak
              </div>
              <div class="mt-1 flex items-baseline gap-3">
                <div class="text-3xl font-semibold tracking-tight" id="streak">0</div>
                <div class="text-sm text-slate-600 dark:text-slate-400">
                  Best:
                  <span
                    class="font-medium text-slate-900 dark:text-slate-100"
                    id="best"
                    >0</span
                  >
                </div>
              </div>
            </div>

            <div class="flex items-center gap-2">
              <button
                id="skipBtn"
                type="button"
                class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-800 shadow-sm transition hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus:ring-slate-700"
                title="New flag"
              >
                New
              </button>
            </div>
          </div>

          <!-- Share -->
          <div class="mt-4 flex flex-wrap items-center gap-2">
            <div class="text-xs font-medium text-slate-600 dark:text-slate-400">
              Share:
            </div>

            <button
              id="shareX"
              type="button"
              class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-800 shadow-sm transition hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus:ring-slate-700"
            >
              X
            </button>

            <button
              id="shareFacebook"
              type="button"
              class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-800 shadow-sm transition hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus:ring-slate-700"
            >
              Facebook
            </button>

            <button
              id="shareLinkedIn"
              type="button"
              class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-800 shadow-sm transition hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus:ring-slate-700"
            >
              LinkedIn
            </button>
          </div>

          <div class="mt-6 flex flex-col items-center">
            <div
              id="flag"
              class="select-none text-7xl leading-none sm:text-8xl"
              aria-label="Country flag"
            >
              üè≥Ô∏è
            </div>

            <div class="mt-3 text-sm text-slate-600 dark:text-slate-400">
              Pick the correct masked country name.
            </div>

            <div id="status" class="sr-only" role="status" aria-live="polite"></div>
          </div>

          <div id="options" class="mt-6 grid grid-cols-1 gap-3 sm:grid-cols-2"></div>

          <div class="mt-5 text-xs text-slate-500 dark:text-slate-400">
            Tip: The blanks are missing letters ‚Äî not spaces.
          </div>
        </section>

        <footer class="mt-6 text-center text-xs text-slate-500 dark:text-slate-500">
          Lightweight, offline-friendly, no trackers.
        </footer>
      </main>
    </div>

    <script>
      // ---------- Data ----------
      function flagFromCode(code) {
        const upper = String(code).toUpperCase();
        if (!/^[A-Z]{2}$/.test(upper)) return "üè≥Ô∏è";
        const A = 0x1f1e6;
        const base = "A".charCodeAt(0);
        return String.fromCodePoint(
          A + (upper.charCodeAt(0) - base),
          A + (upper.charCodeAt(1) - base)
        );
      }

      function getAllRegionCountries() {
        // ‚ÄúAll available‚Äù region codes in the current browser, mapped to names.
        // Works well for ISO country/territory flags; excludes EU/UN since this is a country quiz.
        try {
          if (!Intl?.supportedValuesOf) return null;
          const dn = new Intl.DisplayNames(["en"], { type: "region" });

          const codes = Intl.supportedValuesOf("region")
            .map((c) => String(c).toUpperCase())
            .filter((c) => /^[A-Z]{2}$/.test(c))
            .filter((c) => c !== "EU" && c !== "UN");

          const out = [];
          for (const code of codes) {
            const name = dn.of(code);
            // In some environments, unknowns may return the code itself
            if (!name || String(name).toUpperCase() === code) continue;
            out.push({ code, name, flag: flagFromCode(code) });
          }

          // Keep it stable
          out.sort((a, b) => a.name.localeCompare(b.name));
          return out.length >= 50 ? out : null;
        } catch {
          return null;
        }
      }

      // Fallback list (used only if Intl.supportedValuesOf isn't available)
      const FALLBACK_COUNTRIES = [
        { name: "Canada", code: "CA" },
        { name: "United States", code: "US" },
        { name: "Mexico", code: "MX" },
        { name: "Brazil", code: "BR" },
        { name: "Argentina", code: "AR" },
        { name: "Chile", code: "CL" },
        { name: "Colombia", code: "CO" },
        { name: "Peru", code: "PE" },
        { name: "Spain", code: "ES" },
        { name: "Portugal", code: "PT" },
        { name: "France", code: "FR" },
        { name: "Germany", code: "DE" },
        { name: "Italy", code: "IT" },
        { name: "Netherlands", code: "NL" },
        { name: "Belgium", code: "BE" },
        { name: "Switzerland", code: "CH" },
        { name: "Austria", code: "AT" },
        { name: "Poland", code: "PL" },
        { name: "Czechia", code: "CZ" },
        { name: "Sweden", code: "SE" },
        { name: "Norway", code: "NO" },
        { name: "Denmark", code: "DK" },
        { name: "Finland", code: "FI" },
        { name: "Ireland", code: "IE" },
        { name: "United Kingdom", code: "GB" },
        { name: "Greece", code: "GR" },
        { name: "Turkey", code: "TR" },
        { name: "Egypt", code: "EG" },
        { name: "Morocco", code: "MA" },
        { name: "Tunisia", code: "TN" },
        { name: "South Africa", code: "ZA" },
        { name: "Nigeria", code: "NG" },
        { name: "Kenya", code: "KE" },
        { name: "Ethiopia", code: "ET" },
        { name: "Saudi Arabia", code: "SA" },
        { name: "United Arab Emirates", code: "AE" },
        { name: "Israel", code: "IL" },
        { name: "India", code: "IN" },
        { name: "Pakistan", code: "PK" },
        { name: "Bangladesh", code: "BD" },
        { name: "Sri Lanka", code: "LK" },
        { name: "Thailand", code: "TH" },
        { name: "Vietnam", code: "VN" },
        { name: "Malaysia", code: "MY" },
        { name: "Singapore", code: "SG" },
        { name: "Indonesia", code: "ID" },
        { name: "Philippines", code: "PH" },
        { name: "China", code: "CN" },
        { name: "Japan", code: "JP" },
        { name: "South Korea", code: "KR" },
        { name: "Australia", code: "AU" },
        { name: "New Zealand", code: "NZ" },
      ].map((c) => ({ ...c, flag: flagFromCode(c.code) }));

      let COUNTRIES = getAllRegionCountries();
      if (!COUNTRIES) COUNTRIES = FALLBACK_COUNTRIES;

      // ---------- State ----------
      const els = {
        flag: document.getElementById("flag"),
        options: document.getElementById("options"),
        streak: document.getElementById("streak"),
        best: document.getElementById("best"),
        status: document.getElementById("status"),
        themeBtn: document.getElementById("themeBtn"),
        themeIcon: document.getElementById("themeIcon"),
        skipBtn: document.getElementById("skipBtn"),
        shareX: document.getElementById("shareX"),
        shareFacebook: document.getElementById("shareFacebook"),
        shareLinkedIn: document.getElementById("shareLinkedIn"),
      };

      const STORAGE = {
        theme: "flagfill_theme",
        best: "flagfill_bestStreak",
      };

      const prefersReducedMotion =
        window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches ?? false;

      let current = null; // { answer: {name,code,flag}, options: [...], correctIndex }
      let locked = false;
      let streak = 0;
      let bestStreak = 0;
      let lastAnswerCode = null;

      // ---------- Utils ----------
      function clamp(n, a, b) {
        return Math.max(a, Math.min(b, n));
      }

      function shuffle(array) {
        const a = array.slice();
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function pickOne(array) {
        const countryObject = array[Math.floor(Math.random() * array.length)];        
        return countryObject;
      }

      function pickManyUniqueByCode(array, count, excludedCodes = new Set()) {
        const pool = array.filter((x) => !excludedCodes.has(x.code));
        return shuffle(pool).slice(0, count);
      }

      function setStatus(text) {
        els.status.textContent = text;
      }

      function loadBest() {
        const raw = localStorage.getItem(STORAGE.best);
        const n = raw == null ? 0 : Number(raw);
        bestStreak = Number.isFinite(n) && n >= 0 ? Math.floor(n) : 0;
        els.best.textContent = String(bestStreak);
      }

      function saveBest() {
        localStorage.setItem(STORAGE.best, String(bestStreak));
        els.best.textContent = String(bestStreak);
      }

      function setStreak(n) {
        streak = n;
        els.streak.textContent = String(streak);
        if (streak > bestStreak) {
          bestStreak = streak;
          saveBest();
        }
      }

      function getThemePreference() {
        const saved = localStorage.getItem(STORAGE.theme);
        if (saved === "dark" || saved === "light") return saved;
        const systemDark =
          window.matchMedia?.("(prefers-color-scheme: dark)")?.matches ?? false;
        return systemDark ? "dark" : "light";
      }

      function applyTheme(theme) {
        const isDark = theme === "dark";
        document.documentElement.classList.toggle("dark", isDark);
        els.themeIcon.textContent = isDark ? "‚òÄ" : "‚òæ";
        els.themeBtn.setAttribute("aria-pressed", isDark ? "true" : "false");
        localStorage.setItem(STORAGE.theme, theme);
      }

      function isLetter(ch) {
        return /[A-Z]/.test(ch);
      }

      function maskName(name) {
        const upper = name.toUpperCase();
        const chars = Array.from(upper);
        const letterPositions = [];
        for (let i = 0; i < chars.length; i++) {
          if (isLetter(chars[i])) letterPositions.push(i);
        }

        const letterCount = letterPositions.length;
        const hideCount = clamp(
          Math.floor(letterCount * 0.45),
          letterCount >= 6 ? 2 : 1,
          Math.max(1, letterCount - 2)
        );

        const forbidden = new Set([
          letterPositions[0],
          letterPositions[letterPositions.length - 1],
        ]);
        const candidates = letterPositions.filter((p) => !forbidden.has(p));
        const toHide = new Set(shuffle(candidates).slice(0, hideCount));

        if (toHide.size === 0 && candidates.length > 0) toHide.add(candidates[0]);

        return chars.map((ch, idx) => {
          if (ch === " ") return { type: "space" };
          if (!isLetter(ch)) return { type: "punct", ch };
          return { type: "letter", ch, hidden: toHide.has(idx) };
        });
      }

      // ---------- Rendering ----------
      function letterBoxClasses({ hidden }) {
        return [
          "ff-letter",
          "inline-flex items-center justify-center",
          "h-10 w-8 sm:h-11 sm:w-9",
          "rounded-lg border",
          "text-sm sm:text-base font-semibold",
          "transition-colors",
          hidden ? "text-transparent" : "text-slate-900 dark:text-slate-100",
          "border-slate-200 dark:border-slate-800",
          "bg-white/70 dark:bg-slate-950/30",
        ].join(" ");
      }

      function buildMaskedNameNode(maskedTokens, optionId) {
        const wrap = document.createElement("div");
        wrap.className = "flex flex-wrap items-center gap-1.5";

        let letterIndex = 0;

        for (const token of maskedTokens) {
          if (token.type === "space") {
            const spacer = document.createElement("span");
            spacer.className = "w-2";
            spacer.setAttribute("aria-hidden", "true");
            wrap.appendChild(spacer);
            continue;
          }

          if (token.type === "punct") {
            const el = document.createElement("span");
            el.className =
              "inline-flex h-10 w-5 items-center justify-center text-slate-600 dark:text-slate-400";
            el.textContent = token.ch;
            wrap.appendChild(el);
            continue;
          }

          const box = document.createElement("span");
          box.className = letterBoxClasses({ hidden: token.hidden });
          box.dataset.optionId = optionId;
          box.dataset.letterIndex = String(letterIndex++);
          box.dataset.letter = token.ch;
          box.dataset.hidden = token.hidden ? "1" : "0";

          if (!token.hidden) box.textContent = token.ch;
          wrap.appendChild(box);
        }

        return wrap;
      }

      function optionButtonBaseClasses() {
        return [
          "group",
          "w-full",
          "rounded-2xl border",
          "bg-white p-4 text-left shadow-sm",
          "transition",
          "hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300",
          "disabled:cursor-not-allowed",
          "dark:bg-slate-900 dark:hover:bg-slate-800 dark:focus:ring-slate-700",
          "border-slate-200 dark:border-slate-800",
        ].join(" ");
      }

      function setOptionVisualState(btn, state) {
        btn.dataset.state = state;

        btn.classList.remove(
          "border-emerald-300",
          "bg-emerald-50",
          "dark:bg-emerald-950/30",
          "dark:border-emerald-800",
          "border-rose-300",
          "bg-rose-50",
          "dark:bg-rose-950/30",
          "dark:border-rose-800"
        );

        if (state === "correct") {
          btn.classList.add(
            "border-emerald-300",
            "bg-emerald-50",
            "dark:bg-emerald-950/30",
            "dark:border-emerald-800"
          );
        } else if (state === "wrong") {
          btn.classList.add(
            "border-rose-300",
            "bg-rose-50",
            "dark:bg-rose-950/30",
            "dark:border-rose-800"
          );
        }
      }

      function renderRound(round) {
        els.flag.textContent = round.answer.flag;
        els.flag.classList.remove("animate-pop");
        void els.flag.offsetWidth;
        els.flag.classList.add("animate-pop");

        els.options.innerHTML = "";
        locked = false;
        els.skipBtn.disabled = false;

        round.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = optionButtonBaseClasses();
          btn.setAttribute("aria-label", `Option ${idx + 1}`);
          btn.dataset.index = String(idx);
          setOptionVisualState(btn, "idle");

          const topRow = document.createElement("div");
          topRow.className = "flex items-center justify-between gap-3";

          const label = document.createElement("div");
          label.className = "text-xs font-medium text-slate-600 dark:text-slate-400";
          label.textContent = `Option ${idx + 1}`;

          topRow.appendChild(label);

          const maskedNode = buildMaskedNameNode(opt.masked, String(idx));
          maskedNode.classList.add("mt-2");

          btn.appendChild(topRow);
          btn.appendChild(maskedNode);

          btn.addEventListener("click", () => onPick(idx));
          els.options.appendChild(btn);
        });

        setStatus("New round loaded.");
      }

      // ---------- Gameplay ----------
      function pickAnswer() {
        if (COUNTRIES.length <= 1) return pickOne(COUNTRIES);
        let chosen = pickOne(COUNTRIES);
        let guard = 0;
        while (chosen.code === lastAnswerCode && guard++ < 8) {
          chosen = pickOne(COUNTRIES);
        }
        return chosen;
      }

      function newRound() {
        const answer = pickAnswer();
        lastAnswerCode = answer.code;

        const excluded = new Set([answer.code]);
        const decoys = pickManyUniqueByCode(COUNTRIES, 3, excluded);
        const opts = shuffle([answer, ...decoys]).map((c) => ({
          code: c.code,
          name: c.name,
          masked: maskName(c.name),
        }));
        const correctIndex = opts.findIndex((o) => o.code === answer.code);

        current = { answer, options: opts, correctIndex };
        renderRound(current);
      }

      function disableAllOptions() {
        for (const btn of els.options.querySelectorAll("button")) {
          btn.disabled = true;
        }
      }

      function revealMissingLetters(optionIndex) {
        const optionId = String(optionIndex);
        const boxes = Array.from(
          els.options.querySelectorAll(
            `[data-option-id="${optionId}"][data-hidden="1"]`
          )
        );

        if (boxes.length === 0) return;

        const doReveal = (box) => {
          box.textContent = box.dataset.letter || "";
          box.classList.remove("text-transparent");
          box.classList.add("text-slate-900", "dark:text-slate-100");
          box.classList.add("opacity-0", "translate-y-0.5");
          box.classList.add("transition-all", "duration-200", "ease-out");
          requestAnimationFrame(() => {
            box.classList.remove("opacity-0", "translate-y-0.5");
            box.classList.add("opacity-100", "translate-y-0");
          });
        };

        if (prefersReducedMotion) {
          boxes.forEach(doReveal);
          return;
        }

        boxes.forEach((box, i) => {
          window.setTimeout(() => doReveal(box), i * 55);
        });
      }

      function onPick(index) {
        if (!current || locked) return;
        locked = true;
        els.skipBtn.disabled = true;

        const buttons = Array.from(els.options.querySelectorAll("button"));
        const pickedBtn = buttons[index];

        disableAllOptions();

        const correct = index === current.correctIndex;

        if (correct) {
          setOptionVisualState(pickedBtn, "correct");
          setStatus("Correct. Streak increased.");
          setStreak(streak + 1);
          revealMissingLetters(index);

          window.setTimeout(() => newRound(), prefersReducedMotion ? 300 : 1100);
        } else {
          setOptionVisualState(pickedBtn, "wrong");
          setStatus("Wrong. Streak reset.");
          setStreak(0);

          window.setTimeout(() => newRound(), prefersReducedMotion ? 300 : 800);
        }
      }

      // ---------- Sharing ----------
      function sharePayload() {
        const url = String(location.href).split("#")[0];
        const title = "FlagFill Quiz";
        const text =
          streak > 0
            ? `I‚Äôm on a ${streak} streak in FlagFill Quiz. Can you beat it?`
            : "Try FlagFill Quiz: guess the country from its flag emoji.";
        return { url, title, text };
      }

      function openShare(platform) {
        const { url, text } = sharePayload();
        const u = encodeURIComponent(url);
        const t = encodeURIComponent(text);

        let shareUrl = "";
        if (platform === "x") {
          shareUrl = `https://twitter.com/intent/tweet?text=${t}&url=${u}`;
        } else if (platform === "facebook") {
          shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${u}`;
        } else if (platform === "linkedin") {
          shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${u}`;
        } else {
          return;
        }

        window.open(shareUrl, "_blank", "noopener,noreferrer");
        setStatus("Share window opened.");
      }

      // ---------- Wire up ----------
      els.themeBtn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        applyTheme(isDark ? "light" : "dark");
      });

      els.skipBtn.addEventListener("click", () => {
        if (locked) return;
        newRound();
      });

      els.shareX.addEventListener("click", () => openShare("x"));
      els.shareFacebook.addEventListener("click", () => openShare("facebook"));
      els.shareLinkedIn.addEventListener("click", () => openShare("linkedin"));

      // Init
      applyTheme(getThemePreference());
      loadBest();
      setStreak(0);
      newRound();
    </script>
  </body>
</html>